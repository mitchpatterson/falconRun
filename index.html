<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Falcon Run</title>

<script>var zon = true; // true for comments from zim code</script>
<script src="http://d309knd7es5f10.cloudfront.net/zim_1.4.4_min.js"></script>
<script src="http://code.createjs.com/createjs-2015.05.21.min.js"></script> 
<!-- should use CDN links available from CreateJS and ZIM sites -->
<script src="js/asteroid1.js"></script>
<script src="js/asteroid2.js"></script>
<script src="js/asteroid3.js"></script>
<script src="js/asteroid4.js"></script>
<script src="js/asteroid5.js"></script>
<script src="js/asteroid1med.js"></script>
<script src="js/asteroid2med.js"></script>
<script src="js/asteroid3med.js"></script>
<script src="js/asteroid4med.js"></script>
<script src="js/asteroid5med.js"></script>
<script src="js/asteroid1dark.js"></script>
<script src="js/asteroid2dark.js"></script>
<script src="js/asteroid3dark.js"></script>
<script src="js/asteroid4dark.js"></script>
<script src="js/asteroid5dark.js"></script>
<script src="js/falcon.js"></script>

<style>
	body {margin:0px; padding:0px; background-color:#000;}
	#myCanvas {position:absolute; background-color:#000;/* cursor: none;*/}
</style>

<script>

var scaling = "fit"; // fit scales to fit the browser window while keeping the aspect ratio
var width = 960;
var height = 640;
var frame = new zim.Frame(scaling, width, height); 

frame.on("ready", function() {  
    console.log("ready from ZIM Frame");
    
    var stage = frame.stage;
    var stageW = frame.width;
    var stageH = frame.height;

    
    // used for tiles if there are tiles
    var squareW = 120;
    var squareH = 90;
    var squareS = 20;
    
    var imagePath = "img/";
    var manifest = [{id:"scrollerBack", src:"scrollerBack.png"},
                    {id:"scrollerMid", src:"scrollerMid.png"},
                    {id:"scrollerFront", src:"scrollerFront.png"},
                    {id:"falcon", src:"falcon.png"},
                    {id:"warningAsteroid", src:"warningAsteroid.png"},
                    {id:"title", src:"falconRun_title.png"},
                    {id:"startButton", src:"falconRun_button.png"}];

    var preload = new createjs.LoadQueue(false, imagePath);
    preload.loadManifest(manifest);
    preload.on("complete", game);
    
    
    function game() {
        console.log("____Star Wars Falcon Run____"); 

        var warningAsteroid = new createjs.Bitmap (preload.getResult("warningAsteroid"));

//  scroller Back

        var scrollers = new createjs.Container();
        stage.addChild(scrollers);

        var scrollerBack = new createjs.Bitmap (preload.getResult("scrollerBack"));
        scrollers.addChild(scrollerBack);

        var scrollerBack2 = new createjs.Bitmap (preload.getResult("scrollerBack"));
        scrollers.addChild(scrollerBack2);

        var scrollerSpeed = 3;
        var scroller1 = new zim.Scroller(scrollerBack, scrollerBack2, scrollerSpeed, -.05, false, 5);


// scroller Mid

        var scrollerMid = new createjs.Bitmap (preload.getResult("scrollerMid"));
        scrollers.addChild(scrollerMid);

        var scrollerMid2 = new createjs.Bitmap (preload.getResult("scrollerMid"));
        scrollers.addChild(scrollerMid2);

        var scroller2 = new zim.Scroller(scrollerMid, scrollerMid2, scrollerSpeed, -.08, false, 5);

// scroller Front

        var scrollerFront = new createjs.Bitmap (preload.getResult("scrollerFront"));
        scrollers.addChild(scrollerFront);

        var scrollerFront2 = new createjs.Bitmap (preload.getResult("scrollerFront"));
        scrollers.addChild(scrollerFront2);

        var scroller3 = new zim.Scroller(scrollerFront, scrollerFront2, scrollerSpeed, -.2, false, 5);

// add title screen

        var startScreen = new createjs.Container;
        stage.addChild(startScreen);

        var title = new createjs.Bitmap (preload.getResult("title"));
        startScreen.addChild(title);
        title.x = stageW/2;
        title.y = stageH/2;
        title.regX = title.getBounds().width/2;
        title.regY = title.getBounds().height/2;
        zim.scale(title, 0.5);

        var startButton = new createjs.Bitmap (preload.getResult("startButton"));
        startScreen.addChild(startButton);
        startButton.x = stageW/2;
        startButton.y = stageH/3*2;
        startButton.regX = startButton.getBounds().width/2;
        startButton.regY = startButton.getBounds().height/2;

// adding asteroids
        var asteroids = new createjs.Container;
        stage.addChild(asteroids);

        var asteroid1 = new lib.asteroid1();
        // asteroids.addChild(asteroid1);

        var asteroid2 = new lib.asteroid2();
        // asteroids.addChild(asteroid2);

        var asteroid3 = new lib.asteroid3();
        // asteroids.addChild(asteroid3);

        var asteroid4 = new lib.asteroid4();
        // asteroids.addChild(asteroid4);

        var asteroid5 = new lib.asteroid5();
        // asteroids.addChild(asteroid5);

        var asteroid1med = new lib.asteroid1med();
        // asteroids.addChild(asteroid1med);

        var asteroid2med = new lib.asteroid2med();
        // asteroids.addChild(asteroid2med);

        var asteroid3med = new lib.asteroid3med();
        // asteroids.addChild(asteroid3med);

        var asteroid4med = new lib.asteroid4med();
        // asteroids.addChild(asteroid4med);

        var asteroid5med = new lib.asteroid5med();
        // asteroids.addChild(asteroid5med);

        var asteroid1dark = new lib.asteroid1dark();
        // asteroids.addChild(asteroid1dark);

        var asteroid2dark = new lib.asteroid2dark();
        // asteroids.addChild(asteroid2dark);

        var asteroid3dark = new lib.asteroid3dark();
        // asteroids.addChild(asteroid3dark);

        var asteroid4dark = new lib.asteroid4dark();
        // asteroids.addChild(asteroid4dark);

        var asteroid5dark = new lib.asteroid5dark();
        // asteroids.addChild(asteroid5dark);

// function used to create asteroids off screen at random
        var scrollCheck = false;
        var interval;

        function asteroidBelt() {

            var asteroidArray = [asteroid1, asteroid2, asteroid3, asteroid4, asteroid5, 
                        asteroid1med, asteroid2med, asteroid3med, asteroid4med, asteroid5med,
                        asteroid1dark, asteroid2dark, asteroid3dark, asteroid4dark, asteroid5dark];


            function createAsteroids() {
                var rand = Math.floor(Math.random() * asteroidArray.length);
                return asteroids.addChild(asteroidArray[rand]);
            }

            interval = setInterval(function(){
                randAsteroid = createAsteroids();
                randAsteroid.x = zim.rand(stageW);
                randAsteroid.y = -250;
                randAsteroid.rotation++;
                stage.update();
                // zim.move(randAsteroid, randAsteroid.x, stageH+500, 5000);

                createjs.Tween.get(randAsteroid).to({y:stageH+500}, 3000).call(removeAsteroids);

            }, 2000);

            function removeAsteroids(e) {
                asteroids.removeChild(e.target);
                stage.update();
                console.log("gone");
            }
        };

//  adding the falcon

        var falcon = new lib.falcon();
        // stage.addChild(falcon);
        falcon.x = stageW/2;
        falcon.y = stageH/5*4;
        zim.scale(falcon, .2);
        // falcon.regX = falcon.getBounds().width/2;
        // falcon.regY = falcon.getBounds().height/2;
       
// damping function

        var damp = new zim.Damp(null, .04);
        var damp2 = new zim.Damp(null, .04);

        var startCheck = false; 
        startButton.addEventListener("click", function(){
            scrollerMid.y = 0;
            stage.removeChild(startScreen);
            startCheck = true;
        });

        createjs.Ticker.framerate = 60;
        createjs.Ticker.on("tick", function(){
            falcon.x = damp.convert(stage.mouseX);

            if(startCheck) {
              warningAppear();
              stage.addChild(falcon);

         // asteroidBelt appears

            if(scrollerMid.y > 110 && scrollerMid.y <400) {
                if(!scrollCheck){
                    asteroidBelt();
                    scrollCheck = true;
                } 
            } else {
                if(scrollCheck){
                    zog("clearing");
                    clearInterval(interval);
                }
                scrollCheck = false;
            }
            stage.update();
              }


            stage.update();
        });

// function used to create warning sign for upcoming asteroid field

        function warningAppear(){
            // asteroid Field warning
            if((scrollerMid.y > 50 && scrollerMid.y < 57) || (scrollerMid.y > 64 && scrollerMid.y < 71) || (scrollerMid.y > 78 && scrollerMid.y < 85)|| (scrollerMid.y > 92 && scrollerMid.y < 99)|| (scrollerMid.y > 106 && scrollerMid.y < 113)){
                warningAsteroid.regX = warningAsteroid.getBounds().width/2;
                warningAsteroid.regY = warningAsteroid.getBounds().height/2;
                warningAsteroid.x = stageW/2; 
                warningAsteroid.y = stageH/2; 
                zim.scale(warningAsteroid, .7);

                   stage.addChild(warningAsteroid);
                   stage.update();

            } else {
                stage.removeChild(warningAsteroid);
            }
        }




        stage.update(); 
    } 

});



</script>


</head>

<body>
</body>
</html>